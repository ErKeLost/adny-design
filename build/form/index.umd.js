(function(x,p){typeof exports=="object"&&typeof module!="undefined"?p(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],p):(x=typeof globalThis!="undefined"?globalThis:x||self,p(x.index={},x.Vue))})(this,function(x,p){"use strict";const ne={model:{type:Object,required:!0},rules:{type:Object}};function V(){return V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},V.apply(this,arguments)}function ie(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,M(t,e)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},U(t)}function M(t,e){return M=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},M(t,e)}function ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(t,e,r){return ae()?C=Reflect.construct:C=function(i,f,a){var s=[null];s.push.apply(s,f);var o=Function.bind.apply(i,s),h=new o;return a&&M(h,a.prototype),h},C.apply(null,arguments)}function fe(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function W(t){var e=typeof Map=="function"?new Map:void 0;return W=function(n){if(n===null||!fe(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(n))return e.get(n);e.set(n,i)}function i(){return C(n,arguments,U(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),M(i,n)},W(t)}var se=/%[sdj%]/g,oe=function(){};typeof process!="undefined"&&process.env;function Y(t){if(!t||!t.length)return null;var e={};return t.forEach(function(r){var n=r.field;e[n]=e[n]||[],e[n].push(r)}),e}function w(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var i=0,f=r.length;if(typeof t=="function")return t.apply(null,r);if(typeof t=="string"){var a=t.replace(se,function(s){if(s==="%%")return"%";if(i>=f)return s;switch(s){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch{return"[Circular]"}break;default:return s}});return a}return t}function de(t){return t==="string"||t==="url"||t==="hex"||t==="email"||t==="date"||t==="pattern"}function y(t,e){return!!(t==null||e==="array"&&Array.isArray(t)&&!t.length||de(e)&&typeof t=="string"&&!t)}function ue(t,e,r){var n=[],i=0,f=t.length;function a(s){n.push.apply(n,s||[]),i++,i===f&&r(n)}t.forEach(function(s){e(s,a)})}function Q(t,e,r){var n=0,i=t.length;function f(a){if(a&&a.length){r(a);return}var s=n;n=n+1,s<i?e(t[s],f):r([])}f([])}function ce(t){var e=[];return Object.keys(t).forEach(function(r){e.push.apply(e,t[r]||[])}),e}var X=function(t){ie(e,t);function e(r,n){var i;return i=t.call(this,"Async Validation Error")||this,i.errors=r,i.fields=n,i}return e}(W(Error));function pe(t,e,r,n,i){if(e.first){var f=new Promise(function(q,P){var A=function(d){return n(d),d.length?P(new X(d,Y(d))):q(i)},u=ce(t);Q(u,r,A)});return f.catch(function(q){return q}),f}var a=e.firstFields===!0?Object.keys(t):e.firstFields||[],s=Object.keys(t),o=s.length,h=0,m=[],v=new Promise(function(q,P){var A=function(g){if(m.push.apply(m,g),h++,h===o)return n(m),m.length?P(new X(m,Y(m))):q(i)};s.length||(n(m),q(i)),s.forEach(function(u){var g=t[u];a.indexOf(u)!==-1?Q(g,r,A):ue(g,r,A)})});return v.catch(function(q){return q}),v}function le(t){return!!(t&&t.message!==void 0)}function ye(t,e){for(var r=t,n=0;n<e.length;n++){if(r==null)return r;r=r[e[n]]}return r}function z(t,e){return function(r){var n;return t.fullFields?n=ye(e,t.fullFields):n=e[r.field||t.fullField],le(r)?(r.field=r.field||t.fullField,r.fieldValue=n,r):{message:typeof r=="function"?r():r,fieldValue:n,field:r.field||t.fullField}}}function k(t,e){if(e){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];typeof n=="object"&&typeof t[r]=="object"?t[r]=V({},t[r],n):t[r]=n}}return t}var ee=function(e,r,n,i,f,a){e.required&&(!n.hasOwnProperty(e.field)||y(r,a||e.type))&&i.push(w(f.messages.required,e.fullField))},me=function(e,r,n,i,f){(/^\s+$/.test(r)||r==="")&&i.push(w(f.messages.whitespace,e.fullField))},Z={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},R={integer:function(e){return R.number(e)&&parseInt(e,10)===e},float:function(e){return R.number(e)&&!R.integer(e)},array:function(e){return Array.isArray(e)},regexp:function(e){if(e instanceof RegExp)return!0;try{return!!new RegExp(e)}catch{return!1}},date:function(e){return typeof e.getTime=="function"&&typeof e.getMonth=="function"&&typeof e.getYear=="function"&&!isNaN(e.getTime())},number:function(e){return isNaN(e)?!1:typeof e=="number"},object:function(e){return typeof e=="object"&&!R.array(e)},method:function(e){return typeof e=="function"},email:function(e){return typeof e=="string"&&e.length<=320&&!!e.match(Z.email)},url:function(e){return typeof e=="string"&&e.length<=2048&&!!e.match(Z.url)},hex:function(e){return typeof e=="string"&&!!e.match(Z.hex)}},ge=function(e,r,n,i,f){if(e.required&&r===void 0){ee(e,r,n,i,f);return}var a=["integer","float","array","regexp","object","method","email","number","date","url","hex"],s=e.type;a.indexOf(s)>-1?R[s](r)||i.push(w(f.messages.types[s],e.fullField,e.type)):s&&typeof r!==e.type&&i.push(w(f.messages.types[s],e.fullField,e.type))},he=function(e,r,n,i,f){var a=typeof e.len=="number",s=typeof e.min=="number",o=typeof e.max=="number",h=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,m=r,v=null,q=typeof r=="number",P=typeof r=="string",A=Array.isArray(r);if(q?v="number":P?v="string":A&&(v="array"),!v)return!1;A&&(m=r.length),P&&(m=r.replace(h,"_").length),a?m!==e.len&&i.push(w(f.messages[v].len,e.fullField,e.len)):s&&!o&&m<e.min?i.push(w(f.messages[v].min,e.fullField,e.min)):o&&!s&&m>e.max?i.push(w(f.messages[v].max,e.fullField,e.max)):s&&o&&(m<e.min||m>e.max)&&i.push(w(f.messages[v].range,e.fullField,e.min,e.max))},S="enum",ve=function(e,r,n,i,f){e[S]=Array.isArray(e[S])?e[S]:[],e[S].indexOf(r)===-1&&i.push(w(f.messages[S],e.fullField,e[S].join(", ")))},qe=function(e,r,n,i,f){if(e.pattern){if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(r)||i.push(w(f.messages.pattern.mismatch,e.fullField,r,e.pattern));else if(typeof e.pattern=="string"){var a=new RegExp(e.pattern);a.test(r)||i.push(w(f.messages.pattern.mismatch,e.fullField,r,e.pattern))}}},c={required:ee,whitespace:me,type:ge,range:he,enum:ve,pattern:qe},Fe=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r,"string")&&!e.required)return n();c.required(e,r,i,a,f,"string"),y(r,"string")||(c.type(e,r,i,a,f),c.range(e,r,i,a,f),c.pattern(e,r,i,a,f),e.whitespace===!0&&c.whitespace(e,r,i,a,f))}n(a)},we=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&c.type(e,r,i,a,f)}n(a)},be=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(r===""&&(r=void 0),y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&(c.type(e,r,i,a,f),c.range(e,r,i,a,f))}n(a)},Oe=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&c.type(e,r,i,a,f)}n(a)},xe=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),y(r)||c.type(e,r,i,a,f)}n(a)},_e=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&(c.type(e,r,i,a,f),c.range(e,r,i,a,f))}n(a)},Ae=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&(c.type(e,r,i,a,f),c.range(e,r,i,a,f))}n(a)},Ee=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(r==null&&!e.required)return n();c.required(e,r,i,a,f,"array"),r!=null&&(c.type(e,r,i,a,f),c.range(e,r,i,a,f))}n(a)},je=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&c.type(e,r,i,a,f)}n(a)},Pe="enum",Ve=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f),r!==void 0&&c[Pe](e,r,i,a,f)}n(a)},Ne=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r,"string")&&!e.required)return n();c.required(e,r,i,a,f),y(r,"string")||c.pattern(e,r,i,a,f)}n(a)},Te=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r,"date")&&!e.required)return n();if(c.required(e,r,i,a,f),!y(r,"date")){var o;r instanceof Date?o=r:o=new Date(r),c.type(e,o,i,a,f),o&&c.range(e,o.getTime(),i,a,f)}}n(a)},Se=function(e,r,n,i,f){var a=[],s=Array.isArray(r)?"array":typeof r;c.required(e,r,i,a,f,s),n(a)},G=function(e,r,n,i,f){var a=e.type,s=[],o=e.required||!e.required&&i.hasOwnProperty(e.field);if(o){if(y(r,a)&&!e.required)return n();c.required(e,r,i,s,f,a),y(r,a)||c.type(e,r,i,s,f)}n(s)},De=function(e,r,n,i,f){var a=[],s=e.required||!e.required&&i.hasOwnProperty(e.field);if(s){if(y(r)&&!e.required)return n();c.required(e,r,i,a,f)}n(a)},$={string:Fe,method:we,number:be,boolean:Oe,regexp:xe,integer:_e,float:Ae,array:Ee,object:je,enum:Ve,pattern:Ne,date:Te,url:G,hex:G,email:G,required:Se,any:De};function K(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}var H=K(),D=function(){function t(r){this.rules=null,this._messages=H,this.define(r)}var e=t.prototype;return e.define=function(n){var i=this;if(!n)throw new Error("Cannot configure a schema with no rules");if(typeof n!="object"||Array.isArray(n))throw new Error("Rules must be an object");this.rules={},Object.keys(n).forEach(function(f){var a=n[f];i.rules[f]=Array.isArray(a)?a:[a]})},e.messages=function(n){return n&&(this._messages=k(K(),n)),this._messages},e.validate=function(n,i,f){var a=this;i===void 0&&(i={}),f===void 0&&(f=function(){});var s=n,o=i,h=f;if(typeof o=="function"&&(h=o,o={}),!this.rules||Object.keys(this.rules).length===0)return h&&h(null,s),Promise.resolve(s);function m(u){var g=[],d={};function N(b){if(Array.isArray(b)){var F;g=(F=g).concat.apply(F,b)}else g.push(b)}for(var l=0;l<u.length;l++)N(u[l]);g.length?(d=Y(g),h(g,d)):h(null,s)}if(o.messages){var v=this.messages();v===H&&(v=K()),k(v,o.messages),o.messages=v}else o.messages=this.messages();var q={},P=o.keys||Object.keys(this.rules);P.forEach(function(u){var g=a.rules[u],d=s[u];g.forEach(function(N){var l=N;typeof l.transform=="function"&&(s===n&&(s=V({},s)),d=s[u]=l.transform(d)),typeof l=="function"?l={validator:l}:l=V({},l),l.validator=a.getValidationMethod(l),!!l.validator&&(l.field=u,l.fullField=l.fullField||u,l.type=a.getType(l),q[u]=q[u]||[],q[u].push({rule:l,value:d,source:s,field:u}))})});var A={};return pe(q,o,function(u,g){var d=u.rule,N=(d.type==="object"||d.type==="array")&&(typeof d.fields=="object"||typeof d.defaultField=="object");N=N&&(d.required||!d.required&&u.value),d.field=u.field;function l(O,T){return V({},T,{fullField:d.fullField+"."+O,fullFields:d.fullFields?[].concat(d.fullFields,[O]):[O]})}function b(O){O===void 0&&(O=[]);var T=Array.isArray(O)?O:[O];!o.suppressWarning&&T.length&&t.warning("async-validator:",T),T.length&&d.message!==void 0&&(T=[].concat(d.message));var E=T.map(z(d,s));if(o.first&&E.length)return A[d.field]=1,g(E);if(!N)g(E);else{if(d.required&&!u.value)return d.message!==void 0?E=[].concat(d.message).map(z(d,s)):o.error&&(E=[o.error(d,w(o.messages.required,d.field))]),g(E);var L={};d.defaultField&&Object.keys(u.value).map(function(j){L[j]=d.defaultField}),L=V({},L,u.rule.fields);var re={};Object.keys(L).forEach(function(j){var _=L[j],Ze=Array.isArray(_)?_:[_];re[j]=Ze.map(l.bind(null,j))});var te=new t(re);te.messages(o.messages),u.rule.options&&(u.rule.options.messages=o.messages,u.rule.options.error=o.error),te.validate(u.value,u.rule.options||o,function(j){var _=[];E&&E.length&&_.push.apply(_,E),j&&j.length&&_.push.apply(_,j),g(_.length?_:null)})}}var F;d.asyncValidator?F=d.asyncValidator(d,u.value,b,u.source,o):d.validator&&(F=d.validator(d,u.value,b,u.source,o),F===!0?b():F===!1?b(typeof d.message=="function"?d.message(d.fullField||d.field):d.message||(d.fullField||d.field)+" fails"):F instanceof Array?b(F):F instanceof Error&&b(F.message)),F&&F.then&&F.then(function(){return b()},function(O){return b(O)})},function(u){m(u)},s)},e.getType=function(n){if(n.type===void 0&&n.pattern instanceof RegExp&&(n.type="pattern"),typeof n.validator!="function"&&n.type&&!$.hasOwnProperty(n.type))throw new Error(w("Unknown rule type %s",n.type));return n.type||"string"},e.getValidationMethod=function(n){if(typeof n.validator=="function")return n.validator;var i=Object.keys(n),f=i.indexOf("message");return f!==-1&&i.splice(f,1),i.length===1&&i[0]==="required"?$.required:$[this.getType(n)]||void 0},t}();D.register=function(e,r){if(typeof r!="function")throw new Error("Cannot register a validator by type, validator is not a function");$[e]=r},D.warning=oe,D.messages=H,D.validators=$;const Me=t=>Array.isArray(t);function Re(){const t=p.ref(""),e=async(i,f)=>{if(!Me(i)||!i.length)return!0;const a={inputValidator:i},s={inputValidator:f};new D(a).validate(s).then(()=>{t.value=""},({err:h,fields:m})=>{t.value=m.inputValidator[0].message||null})};return{validate:e,errorMessage:t,validateOfTrigger:async(i,f,a,s)=>{i.includes(f)&&await e(a,s)&&(t.value="")},resetValidation:()=>{t.value=""}}}var I=p.defineComponent({name:"AForm",props:ne,setup(t,e){Re();const r=p.getCurrentInstance();p.provide("formInstance",t);const n=i=>{const s=(r==null?void 0:r.subTree.children[0].children).filter(o=>{var h;return(h=o==null?void 0:o.props)==null?void 0:h.prop}).map(o=>o.component.exposed.validator());return Promise.all(s).then(()=>i(!0)).catch(()=>i(!1))};return e.expose({validate:n}),()=>p.createVNode("div",null,[e.slots.default?e.slots.default():null])}});const $e={label:{type:String},prop:{type:String}},Ie={errorMessage:{type:String,default:""},maxlengthText:{type:String,default:""}};var Ge="",Be=(t,e)=>{for(const[r,n]of e)t[r]=n;return t};const Le=p.defineComponent({name:"AFormDetail",props:Ie}),Ce={key:0,class:"var-form-details"},Je={class:"var-form-details__message"},Ue={class:"var-form-details__length"};function We(t,e,r,n,i,f){return p.openBlock(),p.createBlock(p.Transition,{name:"var-form-details"},{default:p.withCtx(()=>[t.errorMessage||t.maxlengthText?(p.openBlock(),p.createElementBlock("div",Ce,[p.createElementVNode("div",Je,p.toDisplayString(t.errorMessage),1),p.createElementVNode("div",Ue,p.toDisplayString(t.maxlengthText),1)])):p.createCommentVNode("v-if",!0)]),_:1})}var J=Be(Le,[["render",We]]);J.install=function(t){t.component(J.name,J)};var B=p.defineComponent({name:"AFormItem",props:$e,components:{AdnyFormDetail:J},setup(t,e){const r=p.ref(""),n=p.inject("formInstance");p.provide("name",t.prop);const i=()=>{const f=n.model[t.prop],a=n.rules[t.prop];return new D({[t.prop]:a}).validate({[t.prop]:f},(o,h)=>{o?r.value=o[0].message:r.value=""})};return e.expose({validator:i}),()=>p.createVNode(p.Fragment,null,[e.slots.default?e.slots.default():null,p.createVNode(p.resolveComponent("adny-form-detail"),{"error-message":r.value},null)])}});I.install=function(t){t.component(I.name,I)},B.install=function(t){t.component(B.name,B)};var Ye={title:"AForm \u8868\u5355",category:"\u53CD\u9988",status:"30%",install(t){t.use(I),t.use(B)}};x.AForm=I,x.AFormItem=B,x.default=Ye,Object.defineProperty(x,"__esModule",{value:!0}),x[Symbol.toStringTag]="Module"});
